---
import PageLayout from "@layouts/PageLayout.astro";
import Container from "@components/Container.astro";
import { SITE, SOCIALS } from "@consts";
import { socialIconsLarge } from "@lib/icons";
import { getLangFromUrl, useTranslations } from "@i18n/ui";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const blogLink = lang === "pt" ? "/pt/blog" : "/blog";
const copiedText = lang === "pt" ? "Copiado!" : "Copied!";
const clickToCopyText = lang === "pt" ? "Clique para copiar" : "Click to copy";
---

<PageLayout title={t("contact.title")} description="Get in touch with me">
  <Container>
    <div class="space-y-10">
      <div class="flex flex-col items-center gap-6">
        <img
          src="/profile_pic_small.jpeg"
          alt="Gabriel Taufer"
          class="animate w-32 h-32 rounded-full object-cover"
        />
        <div class="animate font-semibold text-black dark:text-white text-center text-2xl">
          {t("contact.title")}
        </div>
      </div>

      <section class="animate space-y-6 text-center">
        <div class="space-y-4">
          <p>
            {t("home.connect.text")}
          </p>
        </div>

        <div class="flex flex-col items-center gap-6 pt-4">
          <h3 class="text-lg font-semibold text-black dark:text-white">
            {t("contact.subtitle")}
          </h3>
          <ul class="flex flex-wrap justify-center gap-6">
            {SOCIALS.map(social => (
              <li>
                <a 
                  href={social.HREF} 
                  target="_blank"
                  rel="noopener noreferrer"
                  aria-label={`${SITE.NAME} on ${social.NAME}`}
                  class="flex items-center justify-center w-12 h-12 rounded-full bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-all hover:scale-110"
                >
                  <span class="text-zinc-600 dark:text-zinc-400" set:html={socialIconsLarge[social.NAME]} />
                </a>
              </li>
            ))}
            <li>
              <a 
                href={blogLink}
                aria-label="Poorthoughts Blog"
                class="flex items-center justify-center w-12 h-12 rounded-full bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-all hover:scale-110"
              >
                <span class="text-zinc-600 dark:text-zinc-400" set:html={socialIconsLarge.poorthoughts} />
              </a>
            </li>
          </ul>

          <div class="flex flex-col items-center gap-2">
            <button 
              id="copy-email-btn"
              class="group flex items-center gap-2 px-4 py-2 rounded-lg bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-all cursor-pointer"
              data-email={SITE.EMAIL}
              data-copied-text={copiedText}
              title={clickToCopyText}
            >
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-zinc-500 dark:text-zinc-400">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" />
              </svg>
              <span id="email-text" class="font-medium text-zinc-700 dark:text-zinc-300">{SITE.EMAIL}</span>
              <svg id="copy-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 text-zinc-400 dark:text-zinc-500 opacity-0 group-hover:opacity-100 transition-opacity">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184" />
              </svg>
              <svg id="check-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4 text-green-500 hidden">
                <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
              </svg>
            </button>
          </div>
        </div>
      </section>
    </div>
  </Container>
</PageLayout>

<script>
  const btn = document.getElementById("copy-email-btn");
  const emailText = document.getElementById("email-text");
  const copyIcon = document.getElementById("copy-icon");
  const checkIcon = document.getElementById("check-icon");

  if (btn && emailText && copyIcon && checkIcon) {
    btn.addEventListener("click", async () => {
      const email = btn.dataset.email;
      const copiedText = btn.dataset.copiedText;
      
      if (email) {
        try {
          await navigator.clipboard.writeText(email);
          
          const originalText = emailText.textContent;
          emailText.textContent = copiedText || "Copied!";
          copyIcon.classList.add("hidden");
          checkIcon.classList.remove("hidden");
          
          setTimeout(() => {
            emailText.textContent = originalText;
            copyIcon.classList.remove("hidden");
            checkIcon.classList.add("hidden");
          }, 2000);
        } catch (err) {
          window.location.href = `mailto:${email}`;
        }
      }
    });
  }
</script>
